<!DOCTYPE html>

<html>
<head>
  <title>Interfaces.hs</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Eval.html">
                Eval.hs
              </a>
            
              
              <a class="source" href="IO.html">
                IO.hs
              </a>
            
              
              <a class="source" href="Interfaces.html">
                Interfaces.hs
              </a>
            
              
              <a class="source" href="Main.html">
                Main.hs
              </a>
            
              
              <a class="source" href="Parser.html">
                Parser.hs
              </a>
            
              
              <a class="source" href="Primitives.html">
                Primitives.hs
              </a>
            
              
              <a class="source" href="Refs.html">
                Refs.hs
              </a>
            
              
              <a class="source" href="Types.html">
                Types.hs
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Interfaces.hs</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="module"><span class="keyword">module</span> Interfaces <span class="keyword">where</span></span>

<span class="import"><span class="keyword">import</span> Text.ParserCombinators.Parsec</span>
<span class="import"><span class="keyword">import</span> System.Environment</span>
<span class="import"><span class="keyword">import</span> Control.Monad</span>
<span class="import"><span class="keyword">import</span> Control.Monad.Error</span>
<span class="import"><span class="keyword">import</span> System.IO</span>
<span class="import"><span class="keyword">import</span> Data.IORef</span>

<span class="import"><span class="keyword">import</span> Types</span>
<span class="import"><span class="keyword">import</span> Refs</span>
<span class="import"><span class="keyword">import</span> IO</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Binary Operations</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="title">numericBinop</span> :: (<span class="type">Integer</span> -&gt; <span class="type">Integer</span> -&gt; <span class="type">Integer</span>) -&gt; [<span class="type">LispVal</span>] -&gt; <span class="type">ThrowsError</span> <span class="type">LispVal</span>
<span class="title">numericBinop</span> op singleVal@[_] = throwError $ <span class="type">NumArgs</span> <span class="number">2</span> singleVal
<span class="title">numericBinop</span> op params = mapM unpackNum params &gt;&gt;= return . <span class="type">Number</span> . foldl1 op

<span class="title">boolBinop</span> :: (<span class="type">LispVal</span> -&gt; <span class="type">ThrowsError</span> a) -&gt; (a -&gt; a -&gt; <span class="type">Bool</span>) -&gt; [<span class="type">LispVal</span>] -&gt; <span class="type">ThrowsError</span> <span class="type">LispVal</span>
<span class="title">boolBinop</span> unpacker op args = <span class="keyword">if</span> length args /= <span class="number">2</span> 
                             <span class="keyword">then</span> throwError $ <span class="type">NumArgs</span> <span class="number">2</span> args
                             <span class="keyword">else</span> <span class="keyword">do</span> left &lt;- unpacker $ args !! <span class="number">0</span>
                                     right &lt;- unpacker $ args !! <span class="number">1</span>
                                     return $ <span class="type">Bool</span> $ left `op` right

<span class="title">numBoolBinop</span> = boolBinop unpackNum
<span class="title">strBoolBinop</span> = boolBinop unpackStr
<span class="title">boolBoolBinop</span> = boolBinop unpackBool</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>Unpack Numbers/Strings/Booleans/Equivalency</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Unpacker</span> = forall a. <span class="type">Eq</span> a =&gt; <span class="type">AnyUnpacker</span> <span class="container">(<span class="type">LispVal</span> -&gt; <span class="type">ThrowsError</span> <span class="title">a</span>)</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><em>requires <code>-XExistentialQuantification</code></em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="title">unpackNum</span> :: <span class="type">LispVal</span> -&gt; <span class="type">ThrowsError</span> <span class="type">Integer</span>
<span class="title">unpackNum</span> (<span class="type">Number</span> n) = return n
<span class="title">unpackNum</span> (<span class="type">String</span> n) = <span class="keyword">let</span> parsed = reads n <span class="keyword">in</span> 
                          <span class="keyword">if</span> null parsed 
                            <span class="keyword">then</span> throwError $ <span class="type">TypeMismatch</span> <span class="string">"number"</span> $ <span class="type">String</span> n
                            <span class="keyword">else</span> return $ fst $ parsed !! <span class="number">0</span>
<span class="title">unpackNum</span> (<span class="type">List</span> [n]) = unpackNum n
<span class="title">unpackNum</span> notNum = throwError $ <span class="type">TypeMismatch</span> <span class="string">"number"</span> notNum

<span class="title">unpackStr</span> :: <span class="type">LispVal</span> -&gt; <span class="type">ThrowsError</span> <span class="type">String</span>
<span class="title">unpackStr</span> (<span class="type">String</span> s) = return s
<span class="title">unpackStr</span> (<span class="type">Number</span> s) = return $ show s
<span class="title">unpackStr</span> (<span class="type">Bool</span> s) = return $ show s
<span class="title">unpackStr</span> notString = throwError $ <span class="type">TypeMismatch</span> <span class="string">"string"</span> notString                                     

<span class="title">unpackStr'</span> :: <span class="type">LispVal</span> -&gt; <span class="type">String</span>
<span class="title">unpackStr'</span> (<span class="type">String</span> s) = s

<span class="title">unpackBool</span> :: <span class="type">LispVal</span> -&gt; <span class="type">ThrowsError</span> <span class="type">Bool</span>
<span class="title">unpackBool</span> (<span class="type">Bool</span> b) = return b
<span class="title">unpackBool</span> notBool = throwError $ <span class="type">TypeMismatch</span> <span class="string">"boolean"</span> notBool                     

<span class="title">unpackEquals</span> :: <span class="type">LispVal</span> -&gt; <span class="type">LispVal</span> -&gt; <span class="type">Unpacker</span> -&gt; <span class="type">ThrowsError</span> <span class="type">Bool</span>
<span class="title">unpackEquals</span> arg1 arg2 (<span class="type">AnyUnpacker</span> unpacker) = 
             <span class="keyword">do</span> unpacked1 &lt;- unpacker arg1
                unpacked2 &lt;- unpacker arg2
                return $ unpacked1 == unpacked2
        `catchError` (const $ return <span class="type">False</span>)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
